{% extends "base.html" %}
{% block title %}Reset Password{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/auth.css') }}?v={{ static_version }}"/>
{% endblock %}

{% block content %}
<div class="auth-container">
  <h2>Reset Password</h2>

  {# Optional: flash messages if you redirect back here #}
  {% if flashes and flashes|length %}
    <div class="flash-stack">
      {% for f in flashes %}
        <div class="alert alert-{{ f.category }}">{{ f.message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <p id="errorMsg" class="error" aria-live="polite"></p>
  
  <form id="resetPasswordForm" novalidate>
    {# Hidden CSRF for future form fallback or debugging #}
    <input type="hidden" name="csrf_token" value="{{ request.cookies.get('XSRF-TOKEN','') }}"/>

    <!-- New Password Input -->
    <div class="floating-field">
      <input
        type="password"
        id="password"
        name="password"
        placeholder=" "
        required
        autocomplete="new-password"
      />
      <label for="password">New Password</label>
    </div>
    <small class="input-error" id="passwordError"></small>

    <!-- Confirm Password Input -->
    <div class="floating-field">
      <input
        type="password"
        id="confirmPassword"
        name="confirm_password"
        placeholder=" "
        required
        autocomplete="new-password"
      />
      <label for="confirmPassword">Confirm Password</label>
    </div>
    <small class="input-error" id="confirmPasswordError"></small>

    <input type="hidden" id="reset_code" name="reset_code" value="{{ reset_token }}" />

    <button type="submit" id="resetPasswordBtn" class="btn-primary">Reset Password</button>
  </form>
  
  <p class="auth-footer-text">
    Remember your password? <a href="/login">Login Here</a>
  </p>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.state.csp_nonce }}" src="{{ url_for('static', path='js/auth/reset_password.js') }}?v={{ static_version }}" defer></script>
{% endblock %}